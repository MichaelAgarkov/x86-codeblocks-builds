From d77ebe5015c066b8b062be333670c8bd75a97bc8 Mon Sep 17 00:00:00 2001
From: Your name <your@qq.com>
Date: Mon, 19 Aug 2024 04:14:59 +0000
Subject: [PATCH] fix 32-bit build and wxSmith

---
 src/plugins/contrib/wxSmith/Makefile.am | 156 +++++++-------
 src/src/Makefile.am                     | 258 ++++++++++++------------
 2 files changed, 207 insertions(+), 207 deletions(-)

diff --git a/src/plugins/contrib/wxSmith/Makefile.am b/src/plugins/contrib/wxSmith/Makefile.am
index 38262bff0..070b0517d 100644
--- a/src/plugins/contrib/wxSmith/Makefile.am
+++ b/src/plugins/contrib/wxSmith/Makefile.am
@@ -1,78 +1,78 @@
-SUBDIRS = properties wxwidgets . plugin
-
-AM_CPPFLAGS = $(WX_CXXFLAGS) \
-		$(CB_SQUIRREL_CFLAGS) \
-		-I$(top_srcdir)/src/include \
-		-I$(top_srcdir)/src/sdk/wxscintilla/include
-
-lib_LTLIBRARIES = libwxsmithlib.la
-
-libwxsmithlib_la_LDFLAGS = -version-info 0:1:0 -shared
-
-libwxsmithlib_la_LIBADD = ../../../sdk/libcodeblocks.la \
-				properties/libwxsmith_properties.la \
-				wxwidgets/libwxsmith_wxwidgets.la \
-				$(WX_LIBS)
-
-libwxsmithlib_la_SOURCES = \
-./wxsadvqpp.cpp \
-./wxsadvqppchild.cpp \
-./wxscoder.cpp \
-./wxscodinglang.cpp \
-./wxseditor.cpp \
-./wxsextresmanager.cpp \
-./wxsgui.cpp \
-./wxsguifactory.cpp \
-./wxsmith.cpp \
-./wxsmithmime.cpp \
-./wxsproject.cpp \
-./wxsresource.cpp \
-./wxsresourcefactory.cpp \
-./wxsresourcetree.cpp \
-./wxsresourcetreeitemdata.cpp \
-./wxsstoringsplitterwindow.cpp \
-./wxsversionconverter.cpp \
-./wxssettings.cpp \
-./wxsautoresourcetreeimage.cpp
-
-sdkdir=$(includedir)/wxsmith/
-
-sdk_HEADERS = \
-./wxsadvqpp.h  \
-./wxsadvqppchild.h \
-./wxsautoresourcetreeimage.h \
-./wxscodinglang.h \
-./wxsgui.h \
-./wxsguifactory.h \
-./wxseditor.h \
-./wxsproject.h \
-./wxsresource.h \
-./wxsresourcefactory.h \
-./wxsresourcetree.h \
-./wxsresourcetreeitemdata.h
-
-noinst_HEADERS = \
-./wxscoder.h \
-./wxsextresmanager.h \
-./wxsmith.h \
-./wxsmithmime.h \
-./wxsstoringsplitterwindow.h \
-./wxsversionconverter.h \
-./wxssettings.h
-
-pkgconfigdir = $(libdir)/pkgconfig
-pkgconfig_DATA = wxsmith.pc
-
-EXTRA_DIST = \
-$(srcdir)/*.cbp \
-$(srcdir)/*.bat \
-$(srcdir)/update* \
-$(srcdir)/wxsmith/* \
-manifest.xml \
-wxs.doxy
-
-pkgdata_DATA = wxsmith.zip
-CLEANFILES = $(pkgdata_DATA)
-
-wxsmith.zip: manifest.xml
-	PWD=`pwd` cd $(srcdir) && zip $(PWD)/wxsmith.zip manifest.xml > /dev/null
+SUBDIRS = properties wxwidgets . plugin
+
+AM_CPPFLAGS = $(WX_CXXFLAGS) \
+		$(CB_SQUIRREL_CFLAGS) \
+		-I$(top_srcdir)/src/include \
+		-I$(top_srcdir)/src/sdk/wxscintilla/include
+
+lib_LTLIBRARIES = libwxsmithlib.la
+
+libwxsmithlib_la_LDFLAGS = @MODULE_SHARED_LDFLAGS@ -version-info 0:1:0 -no-undefined -avoid-version
+
+libwxsmithlib_la_LIBADD = ../../../sdk/libcodeblocks.la \
+				properties/libwxsmith_properties.la \
+				wxwidgets/libwxsmith_wxwidgets.la \
+				$(WX_LIBS)
+
+libwxsmithlib_la_SOURCES = \
+./wxsadvqpp.cpp \
+./wxsadvqppchild.cpp \
+./wxscoder.cpp \
+./wxscodinglang.cpp \
+./wxseditor.cpp \
+./wxsextresmanager.cpp \
+./wxsgui.cpp \
+./wxsguifactory.cpp \
+./wxsmith.cpp \
+./wxsmithmime.cpp \
+./wxsproject.cpp \
+./wxsresource.cpp \
+./wxsresourcefactory.cpp \
+./wxsresourcetree.cpp \
+./wxsresourcetreeitemdata.cpp \
+./wxsstoringsplitterwindow.cpp \
+./wxsversionconverter.cpp \
+./wxssettings.cpp \
+./wxsautoresourcetreeimage.cpp
+
+sdkdir=$(includedir)/wxsmith/
+
+sdk_HEADERS = \
+./wxsadvqpp.h  \
+./wxsadvqppchild.h \
+./wxsautoresourcetreeimage.h \
+./wxscodinglang.h \
+./wxsgui.h \
+./wxsguifactory.h \
+./wxseditor.h \
+./wxsproject.h \
+./wxsresource.h \
+./wxsresourcefactory.h \
+./wxsresourcetree.h \
+./wxsresourcetreeitemdata.h
+
+noinst_HEADERS = \
+./wxscoder.h \
+./wxsextresmanager.h \
+./wxsmith.h \
+./wxsmithmime.h \
+./wxsstoringsplitterwindow.h \
+./wxsversionconverter.h \
+./wxssettings.h
+
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = wxsmith.pc
+
+EXTRA_DIST = \
+$(srcdir)/*.cbp \
+$(srcdir)/*.bat \
+$(srcdir)/update* \
+$(srcdir)/wxsmith/* \
+manifest.xml \
+wxs.doxy
+
+pkgdata_DATA = wxsmith.zip
+CLEANFILES = $(pkgdata_DATA)
+
+wxsmith.zip: manifest.xml
+	PWD=`pwd` cd $(srcdir) && zip $(PWD)/wxsmith.zip manifest.xml > /dev/null
diff --git a/src/src/Makefile.am b/src/src/Makefile.am
index 49d5dd98b..3e94c1a9c 100644
--- a/src/src/Makefile.am
+++ b/src/src/Makefile.am
@@ -1,129 +1,129 @@
-SUBDIRS = resources
-
-AM_CPPFLAGS = $(WX_CXXFLAGS) \
-			$(CB_SQUIRREL_CFLAGS) \
-			-I$(top_srcdir)/src/sdk/wxscintilla/include \
-			-I$(top_srcdir)/src/include
-
-if GTK_NOTEBOOK
-GTK_NOTEBOOK_FLAGS = -DUSE_GTK_NOTEBOOK
-endif
-
-if CODEBLOCKS_LINUX
-AM_CPPFLAGS += -DENABLE_BINRELOC -DAPP_PREFIX="\"@prefix@\"" $(WX_GTK_CFLAGS) $(GTK_NOTEBOOK_FLAGS)
-endif
-
-bin_PROGRAMS = codeblocks
-
-# wxMac resource fork/unbundled app
-install-exec-hook:
-	$(POSTLINK_COMMAND) $(DESTDIR)$(bindir)/codeblocks$(EXEEXT) \
-	                    $(srcdir)/resources/icons/app.r
-	$(MACSETFILE) -a C $(DESTDIR)$(bindir)/codeblocks$(EXEEXT)
-
-# wxAUI uses GTK+ libraries on wxGTK
-# codeblocks_LDFLAGS = $(WX_GTK_LIBS)
-
-codeblocks_LDADD =  ../sdk/libcodeblocks.la \
-			$(WX_LIBS) \
-			$(WX_GTK_LIBS) \
-			$(CB_SQUIRREL_LIBS)
-
-codeblocks_SOURCES = app.cpp \
-			appglobals.cpp \
-			backtracedlg.cpp \
-			breakpointsdlg.cpp \
-			compilersettingsdlg.cpp \
-			cpuregistersdlg.cpp \
-			crashhandler.cpp \
-			debugger_interface_creator.cpp \
-			debuggermenu.cpp \
-			debuggersettingscommonpanel.cpp \
-			debuggersettingsdlg.cpp \
-			debuggersettingspanel.cpp \
-			disassemblydlg.cpp \
-			dlgabout.cpp \
-			dlgaboutplugin.cpp \
-			editkeywordsdlg.cpp \
-			editorconfigurationdlg.cpp \
-			editprojectglobsdlg.cpp \
-			environmentsettingsdlg.cpp \
-			examinememorydlg.cpp \
-			find_replace.cpp \
-			goto_file.cpp \
-			infopane.cpp \
-			main.cpp \
-			manageglobsdlg.cpp \
-			notebookstyles.cpp \
-			printdlg.cpp \
-			projectmanagerui.cpp \
-			projectdepsdlg.cpp \
-			projectoptionsdlg.cpp \
-			recentitemslist.cpp \
-			scriptconsole.cpp \
-			scriptingsettingsdlg.cpp \
-			splashscreen.cpp \
-			startherepage.cpp \
-			switcherdlg.cpp \
-			threadsdlg.cpp \
-			uservardlgs.cpp \
-			virtualbuildtargetsdlg.cpp \
-			watchesdlg.cpp
-
-if CODEBLOCKS_NT
-codeblocks_LDADD += resources.$(OBJEXT) -lexchndl -lcomctl32
-codeblocks_DEPENDENCIES = resources.$(OBJEXT)
-codeblocks_SOURCES += associations.cpp
-resources.$(OBJEXT): resources/resources.rc resources/amd64_dpi_aware_on.manifest
-	$(WINDRES) $(WX_CXXFLAGS) -DcbDPI_AWARE_ON --include-dir $(top_srcdir)/src $< $@
-endif
-
-noinst_HEADERS = app.h \
-			appglobals.h \
-			backtracedlg.h \
-			batchbuild.h \
-			breakpointsdlg.h \
-			compilersettingsdlg.h \
-			cpuregistersdlg.h \
-			crashhandler.h \
-			debugger_interface_creator.h \
-			debuggermenu.h \
-			debuggersettingscommonpanel.h \
-			debuggersettingsdlg.h \
-			debuggersettingspanel.h \
-			disassemblydlg.h \
-			dlgabout.h \
-			dlgaboutplugin.h \
-			editkeywordsdlg.h \
-			editorconfigurationdlg.h \
-			editprojectglobsdlg.h \
-			environmentsettingsdlg.h \
-			examinememorydlg.h \
-			find_replace.h \
-			goto_file.h \
-			infopane.h \
-			main.h \
-			manageglobsdlg.h \
-			notebookstyles.h \
-			printdlg.h \
-			projectmanagerui.h \
-			projectdepsdlg.h \
-			projectoptionsdlg.h \
-			recentitemslist.h \
-			scriptconsole.h \
-			scriptingsettingsdlg.h \
-			splashscreen.h \
-			startherepage.h \
-			switcherdlg.h \
-			threadsdlg.h \
-			uservardlgs.h \
-			virtualbuildtargetsdlg.h \
-			watchesdlg.h
-
-man_MANS = codeblocks.1
-
-EXTRA_DIST = associations.cpp \
-			associations.h \
-			ipc.h \
-			ipc.cpp \
-			$(man_MANS)
+SUBDIRS = resources
+
+AM_CPPFLAGS = $(WX_CXXFLAGS) \
+			$(CB_SQUIRREL_CFLAGS) \
+			-I$(top_srcdir)/src/sdk/wxscintilla/include \
+			-I$(top_srcdir)/src/include
+
+if GTK_NOTEBOOK
+GTK_NOTEBOOK_FLAGS = -DUSE_GTK_NOTEBOOK
+endif
+
+if CODEBLOCKS_LINUX
+AM_CPPFLAGS += -DENABLE_BINRELOC -DAPP_PREFIX="\"@prefix@\"" $(WX_GTK_CFLAGS) $(GTK_NOTEBOOK_FLAGS)
+endif
+
+bin_PROGRAMS = codeblocks
+
+# wxMac resource fork/unbundled app
+install-exec-hook:
+	$(POSTLINK_COMMAND) $(DESTDIR)$(bindir)/codeblocks$(EXEEXT) \
+	                    $(srcdir)/resources/icons/app.r
+	$(MACSETFILE) -a C $(DESTDIR)$(bindir)/codeblocks$(EXEEXT)
+
+# wxAUI uses GTK+ libraries on wxGTK
+# codeblocks_LDFLAGS = $(WX_GTK_LIBS)
+
+codeblocks_LDADD =  ../sdk/libcodeblocks.la \
+			$(WX_LIBS) \
+			$(WX_GTK_LIBS) \
+			$(CB_SQUIRREL_LIBS)
+
+codeblocks_SOURCES = app.cpp \
+			appglobals.cpp \
+			backtracedlg.cpp \
+			breakpointsdlg.cpp \
+			compilersettingsdlg.cpp \
+			cpuregistersdlg.cpp \
+			crashhandler.cpp \
+			debugger_interface_creator.cpp \
+			debuggermenu.cpp \
+			debuggersettingscommonpanel.cpp \
+			debuggersettingsdlg.cpp \
+			debuggersettingspanel.cpp \
+			disassemblydlg.cpp \
+			dlgabout.cpp \
+			dlgaboutplugin.cpp \
+			editkeywordsdlg.cpp \
+			editorconfigurationdlg.cpp \
+			editprojectglobsdlg.cpp \
+			environmentsettingsdlg.cpp \
+			examinememorydlg.cpp \
+			find_replace.cpp \
+			goto_file.cpp \
+			infopane.cpp \
+			main.cpp \
+			manageglobsdlg.cpp \
+			notebookstyles.cpp \
+			printdlg.cpp \
+			projectmanagerui.cpp \
+			projectdepsdlg.cpp \
+			projectoptionsdlg.cpp \
+			recentitemslist.cpp \
+			scriptconsole.cpp \
+			scriptingsettingsdlg.cpp \
+			splashscreen.cpp \
+			startherepage.cpp \
+			switcherdlg.cpp \
+			threadsdlg.cpp \
+			uservardlgs.cpp \
+			virtualbuildtargetsdlg.cpp \
+			watchesdlg.cpp
+
+if CODEBLOCKS_NT
+codeblocks_LDADD += resources.$(OBJEXT) -lexchndl -lcomctl32
+codeblocks_DEPENDENCIES = resources.$(OBJEXT)
+codeblocks_SOURCES += associations.cpp
+resources.$(OBJEXT): resources/resources.rc resources/amd64_dpi_aware_on.manifest
+	$(WINDRES) $(WX_CPPFLAGS) -DcbDPI_AWARE_ON --include-dir $(top_srcdir)/src $< $@
+endif
+
+noinst_HEADERS = app.h \
+			appglobals.h \
+			backtracedlg.h \
+			batchbuild.h \
+			breakpointsdlg.h \
+			compilersettingsdlg.h \
+			cpuregistersdlg.h \
+			crashhandler.h \
+			debugger_interface_creator.h \
+			debuggermenu.h \
+			debuggersettingscommonpanel.h \
+			debuggersettingsdlg.h \
+			debuggersettingspanel.h \
+			disassemblydlg.h \
+			dlgabout.h \
+			dlgaboutplugin.h \
+			editkeywordsdlg.h \
+			editorconfigurationdlg.h \
+			editprojectglobsdlg.h \
+			environmentsettingsdlg.h \
+			examinememorydlg.h \
+			find_replace.h \
+			goto_file.h \
+			infopane.h \
+			main.h \
+			manageglobsdlg.h \
+			notebookstyles.h \
+			printdlg.h \
+			projectmanagerui.h \
+			projectdepsdlg.h \
+			projectoptionsdlg.h \
+			recentitemslist.h \
+			scriptconsole.h \
+			scriptingsettingsdlg.h \
+			splashscreen.h \
+			startherepage.h \
+			switcherdlg.h \
+			threadsdlg.h \
+			uservardlgs.h \
+			virtualbuildtargetsdlg.h \
+			watchesdlg.h
+
+man_MANS = codeblocks.1
+
+EXTRA_DIST = associations.cpp \
+			associations.h \
+			ipc.h \
+			ipc.cpp \
+			$(man_MANS)
-- 

--- a/src/sdk/configmanager.cpp	(revision 13538)
+++ b/src/sdk/configmanager.cpp	(working copy)
@@ -1497,7 +1497,7 @@
     if (plugin_path_global.IsEmpty())
     {
         if (platform::windows)
-            ConfigManager::plugin_path_global = app_path + _T("/../lib/codeblocks/plugins");
+            ConfigManager::plugin_path_global = app_path + _T("\\..\\lib\\codeblocks\\plugins");
         else if (platform::macosx)
             ConfigManager::plugin_path_global = data_path_global + _T("/plugins");
         else
         
2.46.0

